"use strict";function OmBox(t,e){this.window=document.getElementById(t),"undefined"==typeof e&&(e=OMBOX_DEFAULT),this.parseCustomize(e),this.overlay&&this.overlayCreate();for(var o=document.getElementsByTagName("script"),i=0;i<o.length;i++){var n=o[i].src.split("OmBox.js");2===n.length&&(this.serverLocation=n[0])}this.init()}function touchHandler(t){var e=t.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(o),t.preventDefault()}function touchDefault(t){t.addEventListener("touchstart",touchHandler,!0),t.addEventListener("touchmove",touchHandler,!0),t.addEventListener("touchend",touchHandler,!0),t.addEventListener("touchcancel",touchHandler,!0)}function clickDefault(t){t.ontouchstart=t.onclick,t.ontouchmove=function(){return!0},t.ontouchend=function(){return!0},t.ontouchcancel=function(){return!0}}function getMouseXY(t){var e={};return isset(t)?(e.x=t.pageX,e.y=t.pageY):(e.x=event.clientX+document.body.scrollLeft,e.y=event.clientY+document.body.scrollTop),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e}function isset(t){return"undefined"==typeof t?!1:!0}function in_array(t,e,o){var i="",n=!!o;if(n){for(i in e)if(e[i]===t)return!0}else for(i in e)if(e[i]==t)return!0;return!1}var OmBoxThemes=[],OmBoxes=[],OMBOX_DEFAULT={theme:"OmDefault",title:"",resizeable:!0,classOn:"OmBoxSlideOn",classOff:"OmBoxSlideOff",deleteButton:!0,fullSizeButton:!0,outButton:!0,footer:!0,top:20,overlay:!1};OmBox.prototype={init:function(){OmBoxes.length<1&&this.loadTheme("OmBoxCore"),this.contentInit(),this.headerCreate(),this.footer&&this.footerCreate(),this.buttonEnable(),this.setTheme(this.theme),this.clear(),OmBoxes.push(this);var t="ontouchstart"in window;return t&&this.mobileSetup(),this},contentInit:function(){this.contents=this.window.getElementsByTagName("div")[0],this.contents||(this.contents=document.createElement("div"),this.window.appendChild(this.contents))},headerCreate:function(){this.boxTop=document.createElement("div"),this.controlsWrap=document.createElement("span"),this.moveAbleWrap=document.createElement("a"),this.moveAbleWrap.href="javascript:void(0)",this.titleElement=document.createElement("h3"),this.titleElement.innerHTML=this.title,this.deleteButton&&(this.deleteButton=document.createElement("a"),this.deleteButton.href="javascript:void(0)",this.controlsWrap.appendChild(this.deleteButton)),this.fullSizeButton&&(this.fullSizeButton=document.createElement("a"),this.fullSizeButton.href="javascript:void(0)",this.controlsWrap.appendChild(this.fullSizeButton)),this.outButton&&(this.outButton=document.createElement("a"),this.outButton.href="javascript:void(0)",this.controlsWrap.appendChild(this.outButton)),this.boxTop.appendChild(this.controlsWrap),this.moveAbleWrap.appendChild(this.titleElement),this.boxTop.appendChild(this.moveAbleWrap),this.window.insertBefore(this.boxTop,this.window.firstChild)},footerCreate:function(){this.footer=document.createElement("div"),this.footer.className=this.theme+"Footer",this.resizeHandle=document.createElement("a"),this.resizeHandle.href="javascript:void(0)",this.resizeHandle.className=this.theme+"Handle",this.footer.appendChild(this.resizeHandle),this.window.appendChild(this.footer)},buttonEnable:function(){var t=this;this.moveable(this.boxTop),this.deleteButton&&(this.deleteButton.onclick=function(){t.close()}),this.fullSizeButton&&(this.fullSizeButton.onclick=function(){t.fullSize()}),this.outButton&&(this.outButton.onclick=function(){t.moveOut()}),this.resizeHandle&&this.resize(this.resizeHandle),this.window.onclick=function(){t.zTop()}},show:function(){this.window.style.display="block",this.zTop(),this.overlay&&(this.overlay.style.display="block");var t=this;setTimeout(function(){return isset(this.window.classList)?(t.window.classList.remove(t.classOff),void t.window.classList.add(t.classOn)):(t.window.className=t.theme+" "+t.classOn,!0)},100);var e=document.documentElement,o=(window.pageYOffset||e.scrollTop)-(e.clientTop||0);this.window.style.top=o+this.top+"px"},close:function(){isset(this.window.classList)?(this.window.classList.remove(this.classOn),this.window.classList.add(this.classOff)):this.window.className=this.theme+" "+this.classOff;var t=this;this.overlay&&(t.overlay.style.display="none"),setTimeout(function(){t.window.style.display="none"},1e3)},refresh:function(t){var e=this;this.close(),setTimeout(function(){e.show()},parseInt(t))},clear:function(){return this.window.style.display="none",isset(this.window.classList)?(this.window.classList.remove(this.classOn),void this.window.classList.add(this.classOff)):(this.window.className=this.theme+" "+this.classOff,!0)},zTop:function(){for(var t=0,e=0;e<OmBoxes.length;e++)0===t&&(t=OmBoxes[e].window.style.zIndex||5),parseInt(OmBoxes[e].window.style.zIndex)>t&&(t=OmBoxes[e].window.style.zIndex);this.overlay&&(this.overlay.style.zIndex=++t),this.window.style.zIndex=++t},overlayCreate:function(){this.overlay=document.createElement("div"),this.overlay.className="OmBoxOverlay",this.overlay.display="none",document.body.appendChild(this.overlay)},fullSize:function(){"100%"==this.window.style.width?(this.window.style.top="10px",this.window.style.width="95%",this.window.style.height="80%"):(this.window.style.top="0",this.window.style.left="0",this.window.style.width="100%",this.window.style.height="100%")},moveOut:function(){var t=window.open("","mywindow","width=600,height=600"),e=this.window.innerHTML;t.document.body.innerHTML=e},moveable:function(t){var e=this;t.onmousedown=function(o){this.mouseDown++,e.move(o),isset(o)&&o.preventDefault(),document.body.onclick=function(){e.stopMove(t)}},window.onmouseup=function(){e.stopMove(t)}},move:function(t){this.zTop();var e=this,o=getMouseXY(t),i=o.x,n=o.y;document.body.onmousemove=function(t){var o=getMouseXY(t),s=i-o.x,l=e.window.style.left.split("px")[0]-1.2*s,h=n-o.y,u=e.window.style.top.split("px")[0]-1*h;e.window.style.left=l+"px",e.window.style.top=u+"px",i=o.x,n=o.y}},stopMove:function(t){t.onmousedown=null,document.body.onmousemove=null,document.body.onclick=null,this.moveable(t)},resize:function(t){this.resizeEl=t;var e=this;this.resizeEl.onmousedown=function(t){e.resizeMouseWatch(t),isset(t)&&t.preventDefault(),window.onmouseup=function(){e.stopResize(e.resizeEl)},document.body.onclick=function(){e.stopResize(e.resizeEl)}}},resizeMouseWatch:function(t){var e=this,o=getMouseXY(t),i=e.window.offsetWidth,n=e.window.offsetHeight-30,s=(e.window.offsetTop,o.x),l=o.y;document.body.onmousemove=function(t){var o=getMouseXY(t),h=2*(s-o.x),u=i-h,c=l-o.y,a=n-c;e.window.style.width=u+"px",e.window.style.height=a+"px"}},stopResize:function(t){t.onmousedown=null,document.body.onmousemove=null,document.body.onclick=null,this.resize(t)}},OmBox.prototype.setData=function(t){return isset(t)?"object"==typeof t?(this.contents.innerHTML="",this.contents.appendChild(t),!0):void(this.contents.innerHTML=t):!1},OmBox.prototype.getData=function(){return this.contents.innerHTML},OmBox.prototype.setTheme=function(t){return isset(t)?(in_array(t,OmBoxThemes)||this.loadTheme(t),this.theme=t,this.window.className=t,this.boxTop.className=t+"Top",this.deleteButton&&(this.deleteButton.className=t+"X"),this.fullSizeButton&&(this.fullSizeButton.className=t+"Full"),this.outButton&&(this.outButton.className=t+"Out"),this.footer&&(this.footer.className=t+"Footer"),void(this.contents&&(this.contents.className=t+"Content"))):(console.log("Theme is empty"),!1)},OmBox.prototype.loadTheme=function(t){if(!in_array(t,this.themes)){var e=this.serverLocation+"_themes/"+t+".css";if(isset(e)){var o=document.createElement("link");o.href=e,o.rel="stylesheet",isset(document.head)?document.head.appendChild(o):document.body.insertBefore(o,document.body.firstChild)}OmBoxThemes.push(t)}},OmBox.prototype.parseCustomize=function(t){for(var e=["theme","title","resizeable","classOn","classOff","deleteButton","fullSizeButton","outButton","footer","top","overlay"],o=0;o<e.length;o++){var i=e[o];this[i]=isset(t[e[o]])?t[i]:OMBOX_DEFAULT[i]}return t},OmBox.prototype.mobileSetup=function(){touchDefault(this.boxTop),this.footer&&touchDefault(this.footer),this.deleteButton&&clickDefault(this.deleteButton);var t=this;this.deleteButton&&(this.deleteButton.ontouchstart=function(){t.close()}),this.fullSizeButton&&(this.fullSizeButton.ontouchstart=function(){t.fullSize()}),this.outButton&&(this.outButton.ontouchstart=function(){t.moveOut()})};